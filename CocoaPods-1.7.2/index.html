<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
      <title>CocoaPods 1.7.2 &#8212; Master Repo CDN is Finalized! - CocoaPods Blog</title>
    

    <meta name="description" content="The blog for CocoaPods.org the Cocoa Dependency Manager">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="application/rss+xml" title="CocoaPods Blog" href="/feed.xml">

    <meta charset="utf-8" /><meta content="cocoapods objective-c objc swift package manager libraries documentation search pods podspec podfile cocoa apple ios library" name="keywords" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="The Dependency Manager for iOS &amp; Mac projects" name="description" /><meta content="CocoaPods Dev Team" name="author" /><meta content="summary" name="twitter:card" /><meta content="@CocoaPods" name="twitter:site" /><meta content="@CocoaPods" name="twitter:creator" /><meta content="CocoaPods.org" name="twitter:title" /><meta content="The Dependency Manager for iOS &amp; Mac projects." name="twitter:description" /><meta content="https://www.cocoapods.org/" name="twitter:url" />
    <link rel="shortcut icon" href="https://cocoapods.org/favicons/favicon.ico" type="image/x-icon" /><link rel="apple-touch-icon" href="https://cocoapods.org/favicons/apple-touch-icon.png" /><link rel="apple-touch-icon" sizes="57x57" href="https://cocoapods.org/favicons/apple-touch-icon-57x57.png" /><link rel="apple-touch-icon" sizes="60x60" href="https://cocoapods.org/favicons/apple-touch-icon-60x60.png" /><link rel="apple-touch-icon" sizes="72x72" href="https://cocoapods.org/favicons/apple-touch-icon-72x72.png" /><link rel="apple-touch-icon" sizes="76x76" href="https://cocoapods.org/favicons/apple-touch-icon-76x76.png" /><link rel="apple-touch-icon" sizes="114x114" href="https://cocoapods.org/favicons/apple-touch-icon-114x114.png" /><link rel="apple-touch-icon" sizes="120x120" href="https://cocoapods.org/favicons/apple-touch-icon-120x120.png" /><link rel="apple-touch-icon" sizes="144x144" href="https://cocoapods.org/favicons/apple-touch-icon-144x144.png" /><link rel="apple-touch-icon" sizes="152x152" href="https://cocoapods.org/favicons/apple-touch-icon-152x152.png" />

    <link rel="stylesheet" href="/assets/bootstrap-3b61caa441fab92578453d6681fbf963.css">
    <link rel="stylesheet" href="/assets/main-df7f28d697ab31d8aa461b8f8ff0c7e4.css">
    <link rel="stylesheet" href="/assets/blog-a6cba0ad1ceb964c9a5a5387e033c3ff.css">


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-29866548-3', 'cocoapods.org');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <nav class="navbar navbar-static-top" role="navigation"><section class="container"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-header-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="glyphicon glyphicon-plus"></span></button><a class="navbar-brand" href="https://cocoapods.org"></a></div><div class="collapse navbar-collapse navbar-header-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://cocoapods.org/app">App</a></li><li><a href="https://cocoapods.org/about">About</a></li><li><a href="https://guides.cocoapods.org">Guides</a></li><li class="active"><a href="https://blog.cocoapods.org">Blog</a></li></ul></div></section></nav>

    <div id ="">
<section class="container" >
  <article class="row">
  <header class="col-md-8 col-md-offset-2 headline blog-post">
    
      <h1>CocoaPods 1.7.2 &#8212; Master Repo CDN is Finalized!</h1>
    
    
  </header>
  </article>
</section>
</div>

<section id="content-wrapper" class="post">
  <section class="container">
    <article class="row">
      <article class="author metadata col-md-2 col-md-push-10">
        <header>
          
            
              <img class="gravatar large" src="http://gravatar.com/avatar/ecfc4cf87073033b9ac1547872b5cf78?s=144" height=72 width=72>
            
            
              
                <p><a href="http://twitter.com/igormaka">Igor Makarov</a></p>
              
            
             <p>14 June 2019</p>

            
              <a href="https://twitter.com/igormaka" class="twitter-follow-button" data-show-count="false" data-lang="en">
                Follow @igormaka
              </a>
            
        </header>
      </article>
    
      <article class="content col-md-8">
        <p><em>CocoaPods 1.7.2</em> brings with it the final version of CDN support for the <a href="https://github.com/CocoaPods/Specs">trunk specs repo</a>. </p>

<!-- more -->

<p>It&#39;s been a tale of ridiculous scale, unintended consequences and free open-source plans. CocoaPods is moving to use a CDN which is located at <a href="https://cdn.cocoapods.org/">https://cdn.cocoapods.org/</a> and is still considered experimental. A future release will make it the default spec source.</p>

<p>A CDN is a Content Delivery Network - what this means for CocoaPods is that using CocoaPods won&#39;t require you to have a local copy of all the public Podspecs on your computer. Saving you about a GB of file storage, and shaving a lot of time off <code>pod install</code>s.</p>

<h3 id="scaling-when-free-and-open-source">Scaling when free and open source</h3>

<p>CocoaPods is a free, open-source project run by maintainers in their spare time. As such, it depends on the good graces and sponsorships of multiple tech companies. The initial decision was to store the specs in a GitHub repo, a common practice for a free, open-source project for storing such metadata. </p>

<p>The first hurdles of scale were encountered in 2016, when traffic to the master spec repo has caused GitHub to <a href="/Master-Spec-Repo-Rate-Limiting-Post-Mortem">rate-limit all operations</a>.<br>
A <a href="https://github.com/CocoaPods/CocoaPods/issues/4989#issuecomment-193772935">comment from GitHub</a> at the time stated that this repo alone was using 5 whole server CPUs and consuming terabytes upon terabytes of bandwidth.</p>

<p>The crisis was averted by <a href="/Sharding">sharding the repo</a> to improve algorithmic performance and by limiting all first-time clones to being shallow. </p>

<p>This has solved GitHub&#39;s problem, but CocoaPods&#39; users still had to deal with unsatisfactory performance.</p>

<h3 id="git-as-a-database">Git as a Database</h3>

<p>Git was invented at a time when &quot;slow network&quot; and &quot;no backups&quot; were legitimate design concerns. Running endless builds as part of continuous integration wasn&#39;t commonplace. CDN wasn&#39;t so commonly available.</p>

<p>There are many stories of git repos hitting the hard envelope of git&#39;s design constraints. <a href="https://devblogs.microsoft.com/bharry/the-largest-git-repo-on-the-planet/">Microsoft&#39;s Windows repo</a> is one example. CocoaPods is another.</p>

<p>At the time of writing, the spec repo had:</p>

<ul>
<li>almost 400k commits - half of the Linux Kernel repo!</li>
<li>over 400k directories</li>
<li>over 300k spec files</li>
</ul>

<p>These numbers have caused the repo to take minutes to clone, long times to update and have wasted uncountable CI time. It has also proven to be resistant to tarballing, as this sort of directory structure hits a bottleneck in <code>tar</code> as well. </p>

<h3 id="directory-listing-denied">Directory Listing Denied</h3>

<p>It was obvious to many that the spec repo should be put behind a CDN, but there were several constraints:</p>

<ol>
<li>It had to be a free CDN, as the project is free and open-source.</li>
<li>It had to allow some way of obtaining directory listings, for retrieving versions of pods.</li>
<li>It had to auto-update from GitHub as the source of truth.</li>
</ol>

<p>The <a href="https://github.com/CocoaPods/Core/pull/469">first implementation</a> was a shell script, polling GitHub and piping <code>find</code> into <code>ls</code> into index files. This ran on a machine that was not open or free and therefore could not be the true solution. Nevertheless, this auto-updated repo was put behind a <a href="https://www.jsdelivr.com">jsDelivr CDN</a> and the client interfacing with it was released in <a href="/CocoaPods-1.7.0-beta#cdn-support">1.7.0</a> labeled &quot;highly experimental&quot;.</p>

<h3 id="final-lap-with-netlify">Final Lap with Netlify</h3>

<p>The <a href="https://github.com/CocoaPods/Core/pull/541">final version</a> of the CDN for CocoaPods/Specs was implemented on <a href="https://www.netlify.com">Netlify</a>, a static site hosting service supporting flexible site generation. This solution ticked all the boxes: a generous open-source plan, fast CDN and continuous deployment from GitHub.</p>

<p>Upon each commit, Netlify runs a <a href="https://github.com/CocoaPods/Specs/tree/master/Scripts">specialized script</a> which generates a per-shard index for all the pods and versions in the repo. If you&#39;ve ever noticed that the directory structure for our Podspecs repo was strange, this is what we call sharding. An example of a shard index can be found at <a href="https://cdn.cocoapods.org/all_pods_versions_2_2_2.txt">https://cdn.cocoapods.org/all_pods_versions_2_2_2.txt</a>. This would correspond to <code>~/.cocoapods/repos/master/Specs/2/2/2/</code> locally. </p>

<p>Additionally, we create an <code>all_pods.txt</code> file which contains a list of all pods.  </p>

<p>Finally, any other request made is redirected to GitHub&#39;s CDN.</p>

<h3 id="usage">Usage</h3>

<p>Using the CDN for retrieving specs, while &quot;finalized&quot;, should still be considered experimental until we switch it to be default.</p>

<p>To use the CDN source in your <code>Podfile</code>:</p>

<p>If you don&#39;t have private specs:</p>
<div class="highlight">      </article>
      </article>
      </section>
      
      <div style="background-color:white;">
      <section class="container">
      <article class="row">
      <article class="content col-md-8 col-md-offset-2">
<pre class='highlight'><code class="ruby language-ruby" data-lang="ruby"><span class="n">source</span> <span class="s1">&#39;https://cdn.cocoapods.org/&#39;</span>
</code></pre>      </article>
      </article>
      </section>
      </div>
      
      <section class="container">
      <article class="row">
      <article class="content col-md-8 col-md-offset-2">
</div>
<p>If you have private specs:</p>
<div class="highlight">      </article>
      </article>
      </section>
      
      <div style="background-color:white;">
      <section class="container">
      <article class="row">
      <article class="content col-md-8 col-md-offset-2">
<pre class='highlight'><code class="diff language-diff" data-lang="diff">source &#39;https://github.com/artsy/Specs.git&#39;
<span class="gd">- source &#39;https://github.com/CocoaPods/Specs.git&#39;</span>
<span class="gi">+ source &#39;https://cdn.cocoapods.org/&#39;</span>
</code></pre>      </article>
      </article>
      </section>
      </div>
      
      <section class="container">
      <article class="row">
      <article class="content col-md-8 col-md-offset-2">
</div>
<p>Doing this will break your <code>Podfile.lock</code>, so you are likely to need to run <code>pod update</code> to see the changes (be careful, this may update your Pods also).</p>

<p>If you have a CI setup, it is recommended to cache the new repo dir as it is very small and would save even more time. With 1.7.2 it should be located at <code>~/.cocoapods/repos/cocoapods-</code> (yes, with a <code>-</code>), but we&#39;re looking to improve the naming in an upcoming release.</p>

<p>In an upcoming release, we are planning to make the CDN source the default source!</p>

<p>P.S. Thanks to <a href="https://twitter.com/dnkoutso">@dnkoutso</a> for all the release work!</p>

<p>🚀</p>

      </article>
    </article>
  </section>
</section>

<section id="post-accessories"><section class="container"><div class="row"><article class="content col-md-8 col-md-offset-2"><a data-container="body" data-content="CocoaPods is an open source project. Help us improve these blog posts by sending a pull request. ❤" data-original-title="" data-placement="top" data-toggle="popover" data-trigger="hover" href="https://github.com/CocoaPods/blog.cocoapods.org/tree/master/_posts/2019-06-14-CocoaPods-1.7.2.markdown" id="pull-request" title=""></a><a data-container="body" data-content="Check our out post archives." data-original-title="" data-placement="top" data-toggle="popover" data-trigger="hover" href="/archives" id="archives" title=""></a><div class="author-info"><img class="gravatar large" src="//gravatar.com/avatar/ecfc4cf87073033b9ac1547872b5cf78" /><a class="twitter-follow-button" data-dnt="true" data-show-count="false" href="https://twitter.com/igormaka">Follow igormaka</a></div></article></div></section></section>

<section class="container" id="post-info"><div class="row"><article class="content .col-6 col-sm-6 col-md-4 col-md-offset-2 next "><a href="/CocoaPods-1.7.0-beta" title="CocoaPods 1.7.0 Beta!"><header><h4>Previous Post</h4></header><h3>CocoaPods 1.7.0 Beta!</h3><p>By Dimitris Koutsogiorgas</p><a class="chevron_placeholder back" href="/CocoaPods-1.7.0-beta"></a></a></article><article class="content col-6 col-sm-6 col-md-4 previous"><a href="/CocoaPods-1.8.0-beta" title="CocoaPods 1.8 Beta is Here!"><header><h4>Next Post</h4></header><h3>CocoaPods 1.8 Beta is Here!</h3><p>By Dimitris Koutsogiorgas</p><a class="chevron_placeholder next" href="/CocoaPods-1.8.0-beta"></a></a></article></div></section>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>



    <footer class="page-footer"><section class="container"><div class="row"><article class="col-md-8 col-lg-8 col-sm-12 col-md-offset-2 col-lg-offset-2 col-xs-12"><h4>CocoaPods is a project from</h4><p class="contributors"> <a href="https://twitter.com/dnkoutso">Dimitris Koutsogiorgas</a>, <a href="https://dantoml.com">Danielle Tomlinson</a>, <a href="https://github.com/amorde">Eric Amorde</a>, <a href="https://orta.io">Orta Therox</a>, <a href="https://github.com/paulb777">Paul Beusterien</a>, <a href="https://segiddins.me">Samuel Giddins</a>, and <a href="https://cocoapods.org/about#team">The CocoaPods Dev Team</a> with contributions from <a href="https://github.com/CocoaPods/Specs/graphs/contributors">many, many others</a>.</p><h4>Lovingly sponsored by</h4><p class="sponsors"><a href="http://artsy.net">Artsy</a>, <a href="http://www.usebutton.com">Button</a>, <a href="http://www.capitalone.io">Capital One</a>, <a href="https://circleci.com">CircleCI</a>, <a href="http://discontinuity.eu">Discontinuity</a>, <a href="http://www.fngtps.com">Fingertips</a>, <a href="https://developers.google.com">Google</a>, <a href="https://www.heroku.com">Heroku</a>, <a href="https://netlify.com">Netlify</a>, <a href="https://realm.io">Realm</a>, <a href="http://www.rubymotion.com">RubyMotion</a>, <a href="https://www.sauspiel.de">Sauspiel</a>, <a href="https://www.slack.com">Slack</a>, <a href="https://www.soundcloud.com">SoundCloud</a>, <a href="https://www.stripe.com">Stripe</a>, <a href="https://www.squareup.com">Square</a>, and  <a href="http://www.technologyastronauts.ch">Technology&nbsp;Astronauts</a>.</p></article></div></section></footer><footer class="footer-links"><section class="container"><div class="row"><article class="col-md-8 col-lg-8 col-sm-12 col-md-offset-2 col-lg-offset-2 col-xs-12"><a class="cocoapods-small-logo" href="https://cocoapods.org"></a><ul><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://guides.cocoapods.org/using/troubleshooting.html">Support</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://github.com/CocoaPods/CocoaPods">GitHub Repo</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://status.cocoapods.org">Web Properties Status</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://twitter.com/CocoaPods">@CocoaPods</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="http://groups.google.com/group/cocoapods">Mailing List</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://cocoapods.org/about"><span class="visible-lg-span">CocoaPods</span> Dev Team</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://guides.cocoapods.org/syntax/podfile.html">Podfile Doc<span class="hidden-lg-span">s</span><span class="visible-lg-span">umentation</span></a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://cocoapods.org/legal">Legal / Conduct</a></li></ul></article></div></section></footer>
    <script src="/assets/blog-c2911afb0e1e77d79b486c5c39fe0cc6.js"></script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  </body>
</html>
