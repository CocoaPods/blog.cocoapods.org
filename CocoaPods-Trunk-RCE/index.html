<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

      <title>CocoaPods Trunk: Remote Code Execution found - CocoaPods Blog</title>


    <meta name="description" content="The blog for CocoaPods.org the Cocoa Dependency Manager">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="application/rss+xml" title="CocoaPods Blog" href="/feed.xml">

    <meta charset="utf-8" /><meta content="cocoapods objective-c objc swift package manager libraries documentation search pods podspec podfile cocoa apple ios library" name="keywords" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="The Dependency Manager for iOS &amp; Mac projects" name="description" /><meta content="CocoaPods Dev Team" name="author" /><meta content="summary" name="twitter:card" /><meta content="@CocoaPods" name="twitter:site" /><meta content="@CocoaPods" name="twitter:creator" /><meta content="CocoaPods.org" name="twitter:title" /><meta content="The Dependency Manager for iOS &amp; Mac projects." name="twitter:description" /><meta content="https://www.cocoapods.org/" name="twitter:url" />
    <link rel="shortcut icon" href="https://cocoapods.org/favicons/favicon.ico" type="image/x-icon" /><link rel="apple-touch-icon" href="https://cocoapods.org/favicons/apple-touch-icon.png" /><link rel="apple-touch-icon" sizes="57x57" href="https://cocoapods.org/favicons/apple-touch-icon-57x57.png" /><link rel="apple-touch-icon" sizes="60x60" href="https://cocoapods.org/favicons/apple-touch-icon-60x60.png" /><link rel="apple-touch-icon" sizes="72x72" href="https://cocoapods.org/favicons/apple-touch-icon-72x72.png" /><link rel="apple-touch-icon" sizes="76x76" href="https://cocoapods.org/favicons/apple-touch-icon-76x76.png" /><link rel="apple-touch-icon" sizes="114x114" href="https://cocoapods.org/favicons/apple-touch-icon-114x114.png" /><link rel="apple-touch-icon" sizes="120x120" href="https://cocoapods.org/favicons/apple-touch-icon-120x120.png" /><link rel="apple-touch-icon" sizes="144x144" href="https://cocoapods.org/favicons/apple-touch-icon-144x144.png" /><link rel="apple-touch-icon" sizes="152x152" href="https://cocoapods.org/favicons/apple-touch-icon-152x152.png" />

    <link rel="stylesheet" href="/assets/bootstrap-e8a120c5f14a09c9f135f7471f636047.css">
    <link rel="stylesheet" href="/assets/main-7e4d93042b6c78f36d714787ac981321.css">
    <link rel="stylesheet" href="/assets/blog-5da592a0cf4f7bac79216d6b8bb89a1c.css">


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-29866548-3', 'cocoapods.org');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <nav class="navbar navbar-static-top" role="navigation"><section class="container"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-header-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="glyphicon glyphicon-plus"></span></button><a class="navbar-brand" href="https://cocoapods.org"></a></div><div class="collapse navbar-collapse navbar-header-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://cocoapods.org/app">App</a></li><li><a href="https://cocoapods.org/about">About</a></li><li><a href="https://guides.cocoapods.org">Guides</a></li><li class="active"><a href="https://blog.cocoapods.org">Blog</a></li></ul></div></section></nav>

    <div id ="">
<section class="container" >
  <article class="row">
  <header class="col-md-8 col-md-offset-2 headline blog-post">

      <h1>CocoaPods Trunk: Remote Code Execution found</h1>


  </header>
  </article>
</section>
</div>

<section id="content-wrapper" class="post">
  <section class="container">
    <article class="row">
      <article class="author metadata col-md-2 col-md-push-10">
        <header>


              <img class="gravatar large" src="https://gravatar.com/avatar/f116cb3be23153ec08b94e8bd4dbcfeb?s=144" height=72 width=72>



                <p><a href="https://twitter.com/orta">Orta Therox</a></p>


             <p>19 April 2021</p>


              <a href="https://twitter.com/orta" class="twitter-follow-button" data-show-count="false" data-lang="en">
                Follow @orta
              </a>

        </header>
      </article>

      <article class="content col-md-8">
        <p>Part of the server-side validation for uploading a new CocoaPod to the central repository of Podspecs <a href="https://blog.cocoapods.org/CocoaPods-Trunk/">(trunk)</a> could be exploited to execute arbitrary shell commands on the trunk server. </p>

<p>We were contacted via <a href="https://mastodon.mit.edu/@maxj">Max Justicz</a> this morning who provided us with a great technical write-up and showed how to trigger it for ourselves. The exploit is a combination of un-sanitized user input getting through to a git call param which can be used to send remote payloads. </p>

<p>Being able to execute arbitrary shell commands on the server gave a possible attacker the ability to read the environment variables, which could be used to write to the CocoaPods/Specs repo and read the trunk database.</p>

<p><strong>This means you will need to log in again to trunk again to deploy any new Podspecs</strong>. If you have automated deployment to CocoaPods working right now, <strong>this will break</strong>, and you will need to <code>pod trunk register</code> again and replace your <code>COCOAPODS_TRUNK_TOKEN</code>. We&#39;re sorry, I know that sucks, but it also <em>guarantees</em> that you are the only person with write access to your pods.</p>

<p>If you are not a pod author, you do not need to do anything.</p>

<!-- more -->

<h3 id="patched">Patched</h3>

<p>This vulnerability was introduced on <a href="https://github.com/CocoaPods/trunk.cocoapods.org/pull/137">Jun 4th, 2015</a> and has been fixed as of <a href="https://github.com/CocoaPods/trunk.cocoapods.org/pull/303">11am GMT April 19th 2021</a>. The issue has been patched server-side and does not affect your CocoaPods installation.</p>

<p>As most of the commits in the Specs repo are automated through trunk, we have <a href="https://github.com/orta/specs-repo-git-scanner">built some introspection tools</a> to validate the Specs repo commits are ones which have been created by publishing/deprecating/deleting through trunk. The majority of other commits in the repo are around setting up infra for the CDN support, and CocoaPods release pushes. We don&#39;t think the CocoaPods Specs repo has been tampered with.</p>

<h3 id="how-the-exploit-worked">How the exploit worked</h3>

<p>During the deploy of a podspec to trunk, the server validates that the repo is accessible to git. This is done to help fix potentially broken podspecs with typoes, local auth which won&#39;t work for others or external repos don&#39;t have tags already set up. This validation used to rely on using the git CLI on trunk using <code>git ls-remote</code> to replicate the same check as a user&#39;s git would, but <code>ls-remote</code> has a parameter <a href="https://git-scm.com/docs/git-ls-remote"><code>--upload-pack</code></a> which can be used to execute a new shell.</p>

<p>This meant an attacker could create a specially crafted podspec via <a href="https://guides.cocoapods.org/syntax/podspec.html#source"><code>source</code></a>, which would trigger the <code>--upload-pack</code> param and execute an arbitrary command on trunk.</p>

<h3 id="worst-case-scenario">Worst case scenario</h3>

<p>We&#39;ve not been able to prove that anyone has used this method before Max&#39;s report today. However, just because it hasn&#39;t been proved, doesn&#39;t mean it hasn&#39;t happened. 6 years is a long time. </p>

<p>The worst case scenario is that an attacker could have used this technique to get access to our trunk database. The trunk database contains the same emails which are public in the git history of the Specs repo. The table of information in the database which should not be seen are session keys. These keys act like unique passwords to accounts, and session keys are used to connect authenticated users to pods. We are wiping all session keys.</p>

<p>From the side of our investigation, <em>we cannot automatically detect if someone has deployed a poisoned copy of a Pod</em>. If you want to verify that your Pods have not had an un-expected release, you can use this app to shows the <code>sources</code> for every version of a Pod: <a href="https://pod-sources.cocoapods.org">https://pod-sources.cocoapods.org</a></p>

<h3 id="for-more-information">For more information</h3>

<p>CocoaPods is ran by a set of volunteers in their spare time. If you have any questions or comments about this advisory:</p>

<ul>
<li>Open an issue in <a href="https://github.com/CocoaPods/trunk.cocoapods.org">the trunk repo</a></li>
<li>Email us at our private security email: <a href="mailto:info@cocoapods.org">info@cocoapods.org</a></li>
<li>The security advisory on GitHub: <a href="https://github.com/CocoaPods/trunk.cocoapods.org/security/advisories/GHSA-gx9h-rv35-v9hh">GHSA-gx9h-rv35-v9hh</a></li>
</ul>

<p>If you&#39;re not sure of the email address you used to use, use <code>pod trunk info [pod_name]</code> to see the connected email accounts.</p>

      </article>
    </article>
  </section>
</section>

<section id="post-accessories"><section class="container"><div class="row"><article class="content col-md-8 col-md-offset-2"><a data-container="body" data-content="CocoaPods is an open source project. Help us improve these blog posts by sending a pull request. ❤" data-original-title="" data-placement="top" data-toggle="popover" data-trigger="hover" href="https://github.com/CocoaPods/blog.cocoapods.org/tree/master/_posts/2021-04-19-CocoaPods-Trunk-RCE.markdown" id="pull-request" title=""></a><a data-container="body" data-content="Check our out post archives." data-original-title="" data-placement="top" data-toggle="popover" data-trigger="hover" href="/archives" id="archives" title=""></a><div class="author-info"><img class="gravatar large" src="//gravatar.com/avatar/f116cb3be23153ec08b94e8bd4dbcfeb" /><a class="twitter-follow-button" data-dnt="true" data-show-count="false" href="https://twitter.com/orta">Follow orta</a></div></article></div></section></section>

<section class="container" id="post-info"><div class="row"><article class="content .col-6 col-sm-6 col-md-4 col-md-offset-2 next "><a href="/CocoaPods-1.10.0-beta" title="1.10 Beta Begins!"><header><h4>Previous Post</h4></header><h3>1.10 Beta Begins!</h3><p>By Dimitris Koutsogiorgas</p><a class="chevron_placeholder back" href="/CocoaPods-1.10.0-beta"></a></a></article><article class="content col-6 col-sm-6 col-md-4 previous"><a href="/CocoaPods-1.11.0-beta" title="1.11 Arrives!"><header><h4>Next Post</h4></header><h3>1.11 Arrives!</h3><p>By Dimitris Koutsogiorgas</p><a class="chevron_placeholder next" href="/CocoaPods-1.11.0-beta"></a></a></article></div></section>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>



    <footer class="page-footer"><section class="container"><div class="row"><article class="col-md-8 col-lg-8 col-sm-12 col-md-offset-2 col-lg-offset-2 col-xs-12"><h4>CocoaPods is a project from</h4><p class="contributors"> <a href="https://twitter.com/dnkoutso">Dimitris Koutsogiorgas</a>, <a href="https://dantoml.com">Danielle Tomlinson</a>, <a href="https://github.com/amorde">Eric Amorde</a>, <a href="https://orta.io">Orta Therox</a>, <a href="https://github.com/paulb777">Paul Beusterien</a>, <a href="https://segiddins.me">Samuel Giddins</a>, and <a href="https://cocoapods.org/about#team">The CocoaPods Dev Team</a> with contributions from <a href="https://github.com/CocoaPods/Specs/graphs/contributors">many, many others</a>.</p><h4>Lovingly sponsored by</h4><p class="sponsors"><a href="http://artsy.net">Artsy</a>, <a href="http://www.usebutton.com">Button</a>, <a href="http://www.capitalone.io">Capital One</a>, <a href="https://circleci.com">CircleCI</a>, <a href="http://discontinuity.eu">Discontinuity</a>, <a href="http://www.fngtps.com">Fingertips</a>, <a href="https://developers.google.com">Google</a>, <a href="https://www.heroku.com">Heroku</a>, <a href="https://netlify.com">Netlify</a>, <a href="https://realm.io">Realm</a>, <a href="http://www.rubymotion.com">RubyMotion</a>, <a href="https://www.sauspiel.de">Sauspiel</a>, <a href="https://www.slack.com">Slack</a>, <a href="https://www.soundcloud.com">SoundCloud</a>, <a href="https://www.stripe.com">Stripe</a>, <a href="https://www.squareup.com">Square</a>, and  <a href="http://www.technologyastronauts.ch">Technology&nbsp;Astronauts</a>.</p></article></div></section></footer><footer class="footer-links"><section class="container"><div class="row"><article class="col-md-8 col-lg-8 col-sm-12 col-md-offset-2 col-lg-offset-2 col-xs-12"><a class="cocoapods-small-logo" href="https://cocoapods.org"></a><ul><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://guides.cocoapods.org/using/troubleshooting.html">Support</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://github.com/CocoaPods/CocoaPods">GitHub Repo</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://status.cocoapods.org">Web Properties Status</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://twitter.com/CocoaPods">@CocoaPods</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="http://groups.google.com/group/cocoapods">Mailing List</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://cocoapods.org/about"><span class="visible-lg-span">CocoaPods</span> Dev Team</a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://guides.cocoapods.org/syntax/podfile.html">Podfile Doc<span class="hidden-lg-span">s</span><span class="visible-lg-span">umentation</span></a></li><li class="col-md-3 col-sm-3 col-xs-6"><a href="https://cocoapods.org/legal">Legal / Conduct</a></li></ul></article></div></section></footer>
    <script src="/assets/blog-06bd4c8b4c77cdfbf7d0ddb37525e257.js"></script>

    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  </body>
</html>
